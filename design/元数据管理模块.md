# 元数据管理模块

## 一、模块功能

该模块实现了如下功能：

1. 实现表的创建、删除、修改；

2. 实现数据库的创建、删除、切换；

3. 实现表和数据库的元数据（有哪些数据库，数据库里有哪些表，每个表的结构如何）的持久化。

4. 重启数据库时从持久化的元数据中恢复系统信息。

##  二、数据结构及架构
​	该模块主要涉及以下几个类

1. `Table`类，`TableMeta`类
2. `Database`类
3. `Manager`类
4. `Catalog`类

   类之间的调用关系以及操作磁盘文件的层次关系如下图所示：

![](https://s1.ax1x.com/2020/05/10/Y3NFHS.png)

具体来说：

### `Table`类 

​	是存储模块的上一层，作为表格存在，当其操作表格内部元组数据时，需通过存储模块作为中介。

### `TableMeta`类

​	存储表格的元数据信息，包括

* `databasename` 表格名

* `count` 表格元组个数

* `autoIncrement` 表格自动计数当前数

* `columnLabel` 列属性

​	其利用Java的序列化反序列化机制直接存为文件格式。

​	每个`Database`都会有一份`TableMeta`序列化文件，其中会包括`Database`子表的所有元数据。

### `Database`类

​	作为数据库，管理表。该成员变量记录了其含有子表信息为：

​	`HashMap<String, TableMeta> Databasename-->Table Meta Info`

​	而该变量可以利用Java的序列化机制从磁盘上读写，从而实现持久化的元数据。

### `Manager`类

​	作为管理器，管理数据库。该成员变量记录了他含有的数据库。

​	`HashMap<String, Database> databases Databasename-->Database`

​	其所需要保存的元数据信息为：含有的Database名称，可以简单得保存到文件上，每行代表一个含有的Database。

​	另外，这是一个单例类。

### `Catalog`类

​	这是一个会话，每当有一个用户连接数据库服务器时，从用户到Manager之间就会建立起一个`Catalog`对象，而用户权限等元数据信息则会被保存到存储层我们实现的数据库中。

## 三、功能具体实现

### 实现表的创建、删除、修改，实现数据库的创建、删除、切换：

​	这可以通过维护`Database`或`Manager`中的`HashMap`变量就可以实现

### 元数据持久化和恢复  

​	现有的方案可参见二中所述，我们利用Java的序列化和反序列化，对每个Database；每个Manager都单独存其对应的元数据。

​	另外我们还考虑了一种利用查询语句的元数据持久化方案，可以在查询模块实现后再实现，具体而言，它是这样的：

* 我们使用一个文件记录关键语句`create table` `drop table` `alter table`等直接修改`table`元数据属性的DDL语句。
* 在每次打开数据库时先运行这些语句，自然就恢复了系统的元数据信息。